#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>

#define MAX_BUSES 100
#define MAX_DRIVERS 50
#define MAX_ROUTE_LEN 50
#define MAX_NAME_LEN 30

typedef struct {
    char bus_id[10];
    char model[20];
    int capacity;
    char reg_no[15];
    char status[20];
    char driver[30];
    char route[MAX_ROUTE_LEN];
    char last_maintenance[11];
    float fuel_level;
} Bus;

typedef struct {
    char driver_id[10];
    char name[MAX_NAME_LEN];
    char license[15];
    char phone[15];
    char assigned_bus[10];
} Driver;

typedef struct {
    char bus_id[10];
    char route[MAX_ROUTE_LEN];
    char start_time[6];
    char date[11];
} Trip;

Bus buses[MAX_BUSES];
Driver drivers[MAX_DRIVERS];
Trip trips[100];

int bus_count = 0, driver_count = 0, trip_count = 0;

void clear_screen() {
    system("cls || clear");
}

void initialize_sample_data() {
    strcpy(buses[0].bus_id, "HR001");
    strcpy(buses[0].model, "Tata");
    buses[0].capacity = 40;
    strcpy(buses[0].reg_no, "HR55AB1234");
    strcpy(buses[0].status, "Available");
    strcpy(buses[0].driver, "None");
    strcpy(buses[0].route, "None");
    strcpy(buses[0].last_maintenance, "None");
    buses[0].fuel_level = 100.0;

    strcpy(buses[1].bus_id, "HR002");
    strcpy(buses[1].model, "Leyland");
    buses[1].capacity = 32;
    strcpy(buses[1].reg_no, "HR55AB5678");
    strcpy(buses[1].status, "Available");
    strcpy(buses[1].driver, "None");
    strcpy(buses[1].route, "None");
    strcpy(buses[1].last_maintenance, "None");
    buses[1].fuel_level = 95.5;

    bus_count = 2;

    strcpy(drivers[0].driver_id, "D001");
    strcpy(drivers[0].name, "Rajesh");
    strcpy(drivers[0].license, "DL123456");
    strcpy(drivers[0].phone, "9876543210");
    strcpy(drivers[0].assigned_bus, "None");

    driver_count = 1;
}

void display_fleet_status() {
    printf("\n=== PRAGATI FLEET STATUS ===\n");
    printf("%-8s %-10s %-6s %-12s %-10s %-15s %-15s %-6s\n",
           "BusID","Model","Seats","RegNo","Status","Driver","Route","Fuel");
    printf("-----------------------------------------------------------------------------\n");

    for(int i = 0; i < bus_count; i++) {
        printf("%-8s %-10s %-6d %-12s %-10s %-15s %-15s %.1f%%\n",
               buses[i].bus_id, buses[i].model, buses[i].capacity,
               buses[i].reg_no, buses[i].status, buses[i].driver,
               buses[i].route, buses[i].fuel_level);
    }
}

void add_bus() {
    if(bus_count >= MAX_BUSES) {
        printf("Fleet full!\n");
        return;
    }

    printf("Enter Bus ID: ");
    scanf("%s", buses[bus_count].bus_id);

    printf("Enter Model: ");
    scanf("%s", buses[bus_count].model);

    printf("Enter Capacity: ");
    scanf("%d", &buses[bus_count].capacity);

    printf("Enter Registration No: ");
    scanf("%s", buses[bus_count].reg_no);

    strcpy(buses[bus_count].status, "Available");
    strcpy(buses[bus_count].driver, "None");
    strcpy(buses[bus_count].route, "None");
    strcpy(buses[bus_count].last_maintenance, "None");
    buses[bus_count].fuel_level = 100.0;

    bus_count++;
    printf("Bus added successfully!\n");
}

void add_driver() {
    if(driver_count >= MAX_DRIVERS) {
        printf("Driver limit reached!\n");
        return;
    }

    printf("Enter Driver ID: ");
    scanf("%s", drivers[driver_count].driver_id);

    printf("Enter Name: ");
    scanf("%s", drivers[driver_count].name);

    printf("Enter License: ");
    scanf("%s", drivers[driver_count].license);

    printf("Enter Phone: ");
    scanf("%s", drivers[driver_count].phone);

    strcpy(drivers[driver_count].assigned_bus, "None");
    driver_count++;

    printf("Driver added successfully!\n");
}

void assign_driver() {
    char bid[10], did[10];
    printf("Enter Bus ID: ");
    scanf("%s", bid);
    printf("Enter Driver ID: ");
    scanf("%s", did);

    int b = -1, d = -1;

    for(int i=0;i<bus_count;i++)
        if(strcmp(buses[i].bus_id, bid)==0) b=i;

    for(int i=0;i<driver_count;i++)
        if(strcmp(drivers[i].driver_id, did)==0) d=i;

    if(b==-1 || d==-1) {
        printf("Bus or Driver not found!\n");
        return;
    }

    strcpy(buses[b].driver, drivers[d].name);
    strcpy(buses[b].status, "Assigned");
    strcpy(drivers[d].assigned_bus, bid);

    printf("Driver assigned successfully!\n");
}

void main_menu() {
    int choice;
    initialize_sample_data();

    while(1) {
        clear_screen();
        printf("\n=== PRAGATI BUS MANAGEMENT SYSTEM ===\n");
        printf("1. Fleet Status\n");
        printf("2. Add Bus\n");
        printf("3. Add Driver\n");
        printf("4. Assign Driver\n");
        printf("5. Exit\n");
        printf("Choice: ");
        scanf("%d", &choice);

        clear_screen();

        switch(choice) {
            case 1: display_fleet_status(); break;
            case 2: add_bus(); break;
            case 3: add_driver(); break;
            case 4: assign_driver(); break;
            case 5: exit(0);
            default: printf("Invalid choice!\n");
        }

        printf("\nPress Enter to continue...");
        getchar(); getchar();
    }
}

int main() {
    main_menu();
    return 0;
}
